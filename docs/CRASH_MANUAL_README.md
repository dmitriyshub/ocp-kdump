# Using Crash Tool RPM to analyze a vmcore

To determine the cause of the system crash, you can use the `crash` utility, which provides an interactive prompt very similar to the GNU Debugger (GDB). This utility allows you to interactively analyze a running Linux system as well as a core dump created by `kdump`, `netdump`, `diskdump`, or  `xendump` as well as a running Linux system.

Kernel crashes can be tricky to diagnose, but with the crash utility, you can gain valuable insights into the causes of system failures.

- [Managing, Monitoring and updating the Kernel - Analyizing a core dump](https://docs.redhat.com/en/documentation/red_hat_enterprise_linux/8/html/managing_monitoring_and_updating_the_kernel/analyzing-a-core-dump_managing-monitoring-and-updating-the-kernel#analyzing-a-core-dump_managing-monitoring-and-updating-the-kernel)

## Ensure you have the following

- Crash Utility: The crash utility installed on your analysis machine
- Core Dump File: A core dump file (vmcore) generated by kdump
- Matching Kernel: The debug symbols for the kernel that was running at the time of the crash

---

## Installation and Configuration

- You can install crash using the package manager. For example, on a Red Hat-based system, you can use:

```bash
dnf install crash -y
```

---

- If our kernel is in the same version of the node kernel, enable the relevant yum repos and install the kernel-debuginfo and kernel-debuginfo-common

```bash
subscription-manager repos --enable=rhel-8-for-$(uname -m)-baseos-debug-rpms --enable=rhel-8-for-$(uname -m)-appstream-debug-rpms
yum install kernel-debuginfo-$(uname -r) kernel-debuginfo-common-$(uname -m)-$(uname -r)
```

---

- If the kernel version is different from the nodes, download rpm packages from the [Customer Portal](https://access.redhat.com/downloads/content/package-browser)

- Install the rpm packages

```bash
rpm -i kernel-debuginfo-<kernel-version> kernel-debuginfo-common-<kernel-version>
```

- Check if the vmlinux created under `/usr/lib/debug/lib/modules/<kernel-version>/vmlinux`

---

To start the crash utility, pass the following two necessary parameters:

- The debug-info (a decompressed vmlinuz image), for example `/usr/lib/debug/lib/modules/4.18.0-5.el8.x86_64/vmlinux` provided through a specific kernel-debuginfo package.

- The actual vmcore file, for example `/var/crash/127.0.0.1-2018-10-06-14:05:33/vmcore`

```bash
crash /usr/lib/debug/lib/modules/<kernel-version>/vmlinux /path/to/vmcore
```

---

## Kernel Types

- `vmlinux` is the uncompressed kernel code, `vmlinuz`, and `vmlinux.bin` are compressed versions for booting. `zimage` is an older compressed format, and `bzImage` is an improved version.

[Differences Between vmlinux, vmlinuz, vmlinux.bin, zimage, and bzimage](https://www.baeldung.com/linux/kernel-images)

- `vmlinuz` is a compressed file, but crash requires an uncompressed file `vmlinux`, which is compiled with `-g` option.
Make sure your kernel is compiled with `-g` option, and then you can get an uncompressed `vmlinux` file from compressed `vmlinuz`, using the method as follows: (Not Recommended, Use it only with custom/unofficial kernels)

```bash
od -t x1 -A d /host/usr/lib/modules/4.18.0-372.73.1.el8_6.x86_64/vmlinuz | grep "1f 8b 08"
dd if=/host/usr/lib/modules/$(uname -r)/vmlinuz bs=1 skip=18865 | zcat > /tmp/vmlinux
```

---

[Crash Tool Guide](CRASH_TOOL_README.md)

---

---

[Return to main](../README.md)

---
